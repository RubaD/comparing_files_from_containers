---
 
   - name: collect data about the file
     template:
       src: "{{first_dir}}/{{item['container']}}/{{item.file_path}}"
       dest: "{{first_dir}}/{{item['container']}}/{{item.file_path}}"
     diff: yes
     check_mode: yes
     register: first_file

   - template:
      src: "{{sec_dir}}/{{item['container']}}/{{ item.file_path }}"
      dest: "{{sec_dir}}/{{item['container']}}/{{ item.file_path }}"
     diff: yes
     check_mode: yes
     register: sec_file
  
   - set_fact:
       group_var: [" {{ item.file_path }} in {{item.container }}{{sec_file['owner']}} : {{sec_file['group']}}  to {{first_file['owner']}} : {{first_file['group']}}"]
     when:   first_file['group'] != sec_file['group'] or   first_file['owner'] != sec_file['owner']

   - set_fact:
       changes_list: "{{ changes_list + group_var}}"
     when:  first_file['group'] != sec_file['group'] or   first_file['owner'] != sec_file['owner']


   - set_fact:
       mode_var: [" {{ item.file_name }}'s mode in {{item['container']}} -->  {{sec_file['mode']}} to {{first_file['mode']}}"]
     when: not  first_file['mode'] == sec_file['mode']


   - set_fact:
       changes_list: "{{ changes_list + mode_var}}"
     when: not  first_file['mode'] == sec_file['mode']

   - set_fact:
       context_var: [" {{ item.file_path }}'s secontext in {{item.container}}  --> from  {{first_file['secontext']}} to {{sec_file['secontext']}}"]
     when: not  first_file['secontext'] == sec_file['secontext']

   - set_fact:
       changes_list: "{{ changes_list + context_var}}"
     when: not  first_file['secontext'] == sec_file['secontext']

   - name: get the difference between the files
     shell:
      cmd: diff "{{sec_dir}}/{{item['container']}}/{{ item['file_path'] }}"  "{{first_dir}}/{{item['container']}}/{{ item['file_path'] }}" || true
     register: yy
     ignore_errors: yes
     when: not  first_file['checksum'] == sec_file['checksum']
     delegate_to: localhost

   - name:
     set_fact:
      con_changes: [ { file: "{{ item.file_path }} in {{item['container']}} " , changes: "{{ yy.stdout }}" } ]
     when: not  first_file['checksum'] == sec_file['checksum']

   - name: add the difference to the list
     set_fact:
      content_changes: "{{ con_changes + content_changes}}"
     when: not  first_file['checksum'] == sec_file['checksum']
